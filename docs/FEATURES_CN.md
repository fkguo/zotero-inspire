# Zotero INSPIRE 功能总结

本文档介绍 Zotero INSPIRE 插件的所有功能。

## 目录

- [右键菜单元数据更新](#右键菜单元数据更新)
- [INSPIRE 引用面板](#inspire-引用面板)
- [面板交互功能](#面板交互功能)
- [导航功能](#导航功能)
- [导入功能](#导入功能)
- [元数据处理](#元数据处理)
- [偏好设置](#偏好设置)

---

## 右键菜单元数据更新

在 Zotero 中右键点击条目或文件夹，可以使用以下三种更新模式：

| 模式                   | 描述                                                   |
| ---------------------- | ------------------------------------------------------ |
| **完整更新**     | 获取全部元数据，包括摘要                               |
| **不含摘要更新** | 获取元数据但不更新摘要字段                             |
| **仅引用计数**   | 只更新 INSPIRE 引用数（含/不含自引）和 CrossRef 引用数 |

---

## INSPIRE 引用面板

在条目详情面板中，INSPIRE 插件添加了一个专用面板，包含以下标签页：

| 标签页                  | 功能描述                                     |
| ----------------------- | -------------------------------------------- |
| **References**    | 显示当前文献的参考文献列表                   |
| **Cited by**      | 显示引用当前文献的所有论文                   |
| **Entry Cited**   | 查看某条参考文献的被引记录（点击引用数触发） |
| **Author Papers** | 查看某位作者的所有论文（点击作者名触发）     |
| **🔍 Search**     | INSPIRE 搜索结果（从搜索栏触发时显示）       |

### INSPIRE 搜索

从 Zotero 主搜索栏直接搜索 INSPIRE：

1. 在搜索栏输入 `inspire:` 前缀，后跟搜索词
2. 按 Enter 键执行搜索
3. 搜索结果显示在 INSPIRE 面板的 "Search" 标签页中
4. 也可在 "Search" 标签页中直接用 INSPIRE 语法搜索

**搜索语法示例**：

| 语法 | 说明 |
|------|------|
| `inspire: a Witten` | 搜索作者名为 Witten 的论文 |
| `inspire: t quark mass` | 搜索标题包含 "quark mass" 的论文 |
| `inspire: arXiv:2305.12345` | 搜索特定 arXiv 编号 |
| `inspire: j Phys.Rev.D` | 搜索发表在 Physical Review D 的论文 |

**搜索历史**：

- 最近 10 条搜索会被记住
- 在面板搜索输入框旁的下拉菜单中可快速选择历史搜索
- 可清除搜索历史

---

## 面板交互功能

### 统计图表

在 References、Cited by 和 Author Papers 标签页中，面板顶部显示统计图表:

- **两种视图模式**：**按年份**和**按引用数**
- **汇总统计**：
  - 按年份模式：右上角显示总文章数（如 "45 papers"）
  - 按引用数模式：右上角显示总引用数、h-index、篇均引用（如 "1,234 cit. · h=15 · avg 27.4"）
- **交互筛选**：
  - 点击柱状图可筛选对应区间的条目
  - 按住 Ctrl/Cmd 键可多选多个区间
  - 再次点击已选中的柱状图可取消选择
  - 筛选结果与文本过滤器结合（AND 逻辑）
- **折叠/展开**：点击折叠按钮可收起图表以节省空间
- **折叠自动清空筛选**：折叠瞬间会清空所有图表筛选，避免隐藏过滤器影响列表加载
- **默认折叠**：可在偏好设置中配置图表是否默认折叠
- **作者数过滤**：点击 "≤10 Authors" 按钮可过滤仅显示作者数 ≤10 的论文（排除大型合作组）
- **清除筛选**：有筛选时显示清除按钮，一键清除所有图表筛选

### 搜索与过滤

- **过滤器**：支持多词搜索
- **短语搜索**：使用双引号 `"..."` 包裹文本可进行精确短语匹配，忽略空格和标点符号
  - 例如：`"Phys Rev Lett"` 可匹配 "Physical Review Letters" 或 "Phys. Rev. Lett."
- **期刊缩写支持**：支持使用期刊缩写快速过滤
  - 例如：输入 `"PRL"` 可匹配 "Physical Review Letters"
  - 支持常见物理期刊缩写：PRL、PRC、PRD、JHEP、NPA、NPB、PLB、EPJA、EPJC、CPC、CPL 等
- **特殊字符处理**：自动处理德语变音符（ä→ae）、北欧字符等
- **排序选项**：
  - INSPIRE 原始顺序
  - 最新优先
  - 最多引用优先

### 状态指示

| 图标      | 含义                          |
| --------- | ----------------------------- |
| ● (绿色) | 本地库中已有此条目            |
| ⊕ (红色) | 可点击添加到库                |
| 🔗 (橙色) | 已关联为相关条目              |
| 🔗 (灰色) | 未关联                        |
| 📋        | 复制 BibTeX（点击获取并复制） |

### 交互操作

| 操作                 | 效果                           |
| -------------------- | ------------------------------ |
| 点击圆点（本地已有） | 跳转到本地条目                 |
| 点击圆点（未添加）   | 打开导入对话框                 |
| 点击链接图标         | 关联/取消关联为相关条目        |
| 点击剪贴板图标       | 复制 BibTeX 到剪贴板           |
| 点击引用数           | 打开该条目的被引记录标签页     |
| 点击标题             | 在浏览器中打开 INSPIRE 页面    |
| 悬停标题             | 显示摘要 tooltip（带加载状态） |
| 点击作者名           | 查看该作者的所有论文           |

### 工具栏按钮

| 按钮            | 功能                                            |
| --------------- | ----------------------------------------------- |
| 刷新按钮        | 清除缓存，从 INSPIRE 重新获取当前视图的最新数据 |
| 批量复制 BibTeX | 一键复制所有可见条目的 BibTeX 到剪贴板          |

---

## 导航功能

### 浏览历史

- **Back 按钮**：返回上一个查看的条目
- **Forward 按钮**：前进到下一个条目
- 支持跨阅读器标签页导航
- 可配置自动重新打开已关闭的阅读器标签页

### 使用场景

1. 在 References 面板中点击某条参考文献跳转
2. 使用 Back 按钮返回原来的条目
3. 如果原条目在 PDF 阅读器中打开，可自动切换回阅读器标签

---

## 导入功能

从 INSPIRE 导入条目时，支持以下选项：

### 目标选择

- 选择目标库（个人库/群组库）
- 选择一个或多个目标文件夹
- 可拖拽、可调整大小的选择对话框

### 附加选项

- **标签**：添加标签（支持自动完成，从现有标签中选择）
- **笔记**：为导入的条目添加笔记

---

## 元数据处理

### 更新的字段

| 字段            | 说明                                                                              |
| --------------- | --------------------------------------------------------------------------------- |
| 期刊缩写        | INSPIRE 标准期刊缩写                                                              |
| 卷、期、页码    | 完整的出版信息                                                                    |
| DOI             | 数字对象标识符                                                                    |
| arXiv 信息      | arXiv ID 及主分类                                                                 |
| 引用计数        | 含/不含自引的引用数                                                               |
| 摘要            | 论文摘要（可选）                                                                  |
| 作者列表        | 超过10位作者时保留前3位 + "others"；面板显示时超过20位作者只显示第一位 + "et al." |
| Citation Key    | INSPIRE 的 texkey（可配置）                                                       |
| Archive         | 设为 "INSPIRE"                                                                    |
| Loc. in Archive | INSPIRE recid                                                                     |

### 特殊处理

- **勘误信息**：作为笔记添加
- **数学公式**：清理标题中的 LaTeX 公式

### 数据来源识别

插件可从以下信息获取 INSPIRE 记录：

1. DOI 字段
2. Extra 字段中的 arXiv ID
3. URL 字段中的 arXiv 链接或 INSPIRE 链接
4. Extra 字段中的 DOI
5. Loc. in Archive 字段中的 recid
6. Extra 字段中的 Citation Key

---

## 偏好设置

通过 `工具` → `插件` → `INSPIRE Metadata Updater` → `首选项` 访问：

### 新条目自动获取

| 选项     | 说明                                   |
| -------- | -------------------------------------- |
| 含摘要   | 添加新条目时自动获取完整元数据         |
| 不含摘要 | 添加新条目时自动获取元数据（不含摘要） |
| 仅引用数 | 添加新条目时只获取引用数               |
| 禁用     | 不自动获取                             |

### Citation Key 设置

- **INSPIRE citekey**：使用 INSPIRE 的 texkey 作为 Citation Key
- **禁用**：不设置 Citation Key

### Extra 字段顺序

- **引用优先**：引用数显示在 Extra 字段顶部
- **arXiv 优先**：arXiv ID 显示在 Extra 字段顶部

### arXiv 分类标签

- 启用后，自动将 arXiv 主分类（如 hep-ph、nucl-th）添加为标签

### 引用面板设置

- **最大显示作者数**：设置在面板中显示多少位作者后显示 "et al."

### 阅读器导航设置

- **自动重新打开阅读器**：使用 Back/Forward 导航时，自动重新打开已关闭的阅读器标签页

### INSPIRE 记录未找到

- **添加标签**：为未找到 INSPIRE 记录的条目添加标签（默认：`⛔ No INSPIRE recid found`）

---

## 与其他工具的集成

### Better BibTeX

- 自动设置 INSPIRE Citation Key
- 在 Extra 字段中保存 Citation Key 以便 BBT 识别

### Look-up Engines

可在 Zotero 的 `engines.json` 中添加 INSPIRE 查找引擎：

```json
{
  "_name": "INSPIRE",
  "_urlTemplate": "https://inspirehep.net/literature/{z:archiveLocation}"
}
```

### Actions & Tags 插件

可设置动作一键复制 INSPIRE 链接。

---

## 性能优化

本插件进行了多项性能优化以提升用户体验：

### 渲染优化

- **Filter 防抖**: 快速输入时自动延迟重渲染，避免界面卡顿
- **图表延迟计算**: 图表在后台渲染，不阻塞列表显示
- **Row 元素池化**: 复用 DOM 元素，减少内存分配
- **无限滚动**: 滚动到列表底部时自动加载更多条目

### 数据获取优化

- **Citation Count 并行获取**: 多批次同时请求，减少等待时间
- **本地状态批量查询**: 优化数据库查询，减少交互次数

### 内存管理

- **LRU 缓存**: 限制缓存大小，防止长期使用导致内存增长
- **搜索文本缓存**: 避免重复计算搜索字符串

---

## 技术说明

### API 使用

本插件使用 [INSPIRE REST API](https://github.com/inspirehep/rest-api-doc) 获取数据。

### 速率限制

INSPIRE API 限制每 5 秒最多 15 个请求。插件已优化请求频率以避免超限。

### 缓存

- 引用列表和被引记录会在会话中缓存（LRU 限制）
- 元数据会缓存以减少重复请求（最多 500 条）
- 点击 Refresh 按钮可强制刷新

---

*本文档对应插件版本：1.1.2*
